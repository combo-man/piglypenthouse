pico-8 cartridge // http://www.pico-8.com
version 16
__lua__

//vectors///////////////////////////
function vec_len(x,y)
   return sqrt(x*x+y*y)
end

function vec_sub(a,b)
   return a.x-b.x,a.y-b.y
end

function vec_add(a,b)
   return a.x+b.x,a.y+b.y
end

function vec_dist(a,b)
   return vec_len(vec_sub(a,b))
end

function vec_scale(a,v)
   return a.x*v,a.y*v
end

function rot_vec(x,y,r)
   local cs = cos(r)
   local sn = sin(r)
   local nx = x * cs - y * sn
   local ny = x * sn + y * cs
   return nx,ny
end

//utils////////////////////////////
function cpy(obj)
   local n = {}
   for k,v in pairs(obj) do
      n[k] = v
   end
   return n
end

//constants////////////////////////
grav = .05

coin = {
	x = 0,
   dx = 2,
   rx = .99,
	y = 64,
   dy = -1,
   ry = 1,
   r = 2,
   mv = .5,
   grav = true
}

function move_obj(obj)
   if obj.grav then
      obj.dy += grav
   end
   obj.x += obj.dx
   obj.y += obj.dy
   obj.dx *= obj.rx
   obj.dy *= obj.ry
end

function _update60()
   move_obj(coin)
   ctrl_coin(coin)
end

function ctrl_coin(obj)
   if btn(0) then
      obj.x -= obj.mv
   end
   if btn(1) then
      obj.x += obj.mv
   end
end   

function c_col(a,b)
   return vec_dist(a,b) <= (a.r + b.r)
end

//drawing////////////////////////////////////// 
function future_draw(obj, n)
   local obj_cpy = cpy(obj)
   for i=1,n do 
      move_obj(obj_cpy)
      circfill(obj_cpy.x,obj_cpy.y,.5,7)
   end
end 

function cam_coords(obj)
   local nx = (obj.x + (obj.dx * 0))
   local ny = (obj.y + (obj.dy * 0))
   return nx,ny
end

function dist_lines(n)
   for i=1,n do
      local c = i % 2 == 0 and 8 or 7
      line(i*16,0,i*16,128,c)
   end
end

function grid_lines(s,ox,oy)
   for i=1,flr(128/s) do
      local nx = (i*s + ox) % 128
      local ny = (i*s + oy) % 128
      line(nx,0,nx,128,7)
      line(0,ny,128,ny,6)
   end
end

function _draw()
   cls()
   local nx,ny = cam_coords(coin)
   //grid_lines(16,-nx,-ny) 
   //camera(nx-64,ny-64)
   //future_draw(coin,100)
   local cent = {x=64,y=64,r=16}
   circ(cent.x,cent.y,cent.r,7)
   local col = c_col(coin,cent)
   circfill(coin.x,coin.y,coin.r,col and 7 or 9)
   //camera()
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000aa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000aaaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
